<!DOCTYPE html><script type="module">
import App, { Vec3, Quat, Mat4, Transform, Colour } from "../../fungi/App.js";

import FboFactory from "../../fungi/core/Fbo.js";

import FacedCube from "../../fungi/geo/FacedCube.js";

//import Wireframe    from "../../fungi/shaders/Wireframe.js";
//import Grid         from "../../fungi/geo/Grid.js";

//import Noise        from "../../lib/Noise.js";

//#####################################################
App
	.init( true )
	//.load_shaders( "LowPoly.js" )
	.use_debug()
	.set_camera( 30, 10, 4, 0, 0.5, 0 )
	.task( init )
	.then();

//#####################################################

async function init(){
    // It does realign the axis, but the twist doesn't get clampped correctlu to where it should be

    let hingeAxis = Vec3.UP;
    let q         = new Quat();
    q.from_euler_order( -45, 45, 45 );

    /*
    let inv     = Quat.invert( q );                         // Invert Quaternion
    let invAxis = Vec3.transform_quat( hingeAxis, inv );    // Get the Reverse Axis
    let clamp   = Quat.unit_vecs( hingeAxis, invAxis );     // Clamp Rotation Back to its Hindge Orientation 
    q.mul( clamp );                                         // Apply Clamp
    */

    // More intuitive way, but gives same result with twist being off about the same amount.
    let invAxis = Vec3.transform_quat( hingeAxis, q );    // Get the Reverse Axis
    let clamp   = Quat.unit_vecs( invAxis, hingeAxis );     // Clamp Rotation Back to its Hindge Orientation 
    q.pmul( clamp );                                         // Apply Clamp
    

    App.Debug.quat( q, [0,0.2,0] );
    
    
    //App.Debug.quat( new Quat(), [0,0.0,0] );
    //App.Debug.quat( inv, [0,0.2,0] );


    App.Debug.ln( Vec3.ZERO, invAxis, "yellow" );
    App.Debug.ln( Vec3.ZERO, hingeAxis, "cyan" );
    //App.Debug.ln( Vec3.ZERO, q.get_axis(), "cyan" );
    //App.Debug.ln( Vec3.ZERO, [inv.x, inv.y, inv.z], "yellow" );


	//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
	return true;
}



//#####################################################

//#####################################################

//#####################################################
</script>
<html><head><style>html,body{ margin:0px; padding:0px; width:100%; height:100%; }</style>
</head><body><canvas id="pg_canvas"></canvas></body></html>